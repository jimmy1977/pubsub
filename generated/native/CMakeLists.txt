cmake_minimum_required(VERSION 3.0.2)
project(protogen_nat)

set(PROTOBUF_DIR ${PROJECT_SOURCE_DIR}/../../protobuf)
message(STATUS "PROTODIR : ${PROTOBUF_DIR}")
set(NANOPB_SRC_ROOT_FOLDER "/opt/nanopb-0.4.1/")
file(GLOB DOSCOVERY_PROTO_DEFS "${PROTOBUF_DIR}/discovery/*.proto")
set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} ${NANOPB_SRC_ROOT_FOLDER}/extra)
find_package(Nanopb REQUIRED)
add_compile_options(-fPIC -O3)
include_directories(${NANOPB_INCLUDE_DIRS})
set(NANOPB_OPTIONS "-f ${PROTOBUF_DIR}/discovery/protobuf.options")
NANOPB_GENERATE_CPP(PROTO_SRCS PROTO_HDRS ${DOSCOVERY_PROTO_DEFS})
add_library(protogen_nat STATIC ${PROTO_SRCS})